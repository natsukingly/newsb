
#main_menu
    .index_nav
        =link_to articles_tag_path(@tag.id), class: "news_btn active", remote: true do 
            %i.fa.fa-newspaper-o
            %span.sm
                NEWS
        =link_to posts_tag_path(@tag.id), class: "feed_btn", remote: true do
            %i.fa.fa-commenting-o 
            %span.sm
                FEED
        =link_to users_tag_path(@tag.id), class: "users_btn", remote: true do
            %i.fa.fa-user-circle-o
            %span.sm
                USERS
        
        #sub_menu
            =render "/tags/sub_menu_news", tag: @tag
            
#main_contents
    =render @articles
-if @not_found == true
    .not_found
        %h2 
            no news yet. 
            time to explore!!
        %p
            or click here to post your own article :)
 
:javascript
    
    
    if(#{ @not_found == true }){
        $.ajax({
            url: "/tags/articles_not_found",
            type: "GET",
            dataType: 'script',
        })
        // $('#main_contents').append("#{escape_javascript(render('shared/articles_not_found'))}");
    }

    // awesome autosize code

    
    $(".form_content").height(30);//init
    $(".form_content").css("lineHeight","20px");//init
    
    $(".form_content").on("input",function(evt){
                        if(evt.target.scrollHeight > evt.target.offsetHeight){
                                $(evt.target).height(evt.target.scrollHeight);
                        }else{
                                var lineHeight = Number($(evt.target).css("lineHeight").split("px")[0]);
                                while (true){
                                        $(evt.target).height($(evt.target).height() - lineHeight);
                                        if(evt.target.scrollHeight > evt.target.offsetHeight){
                                                $(evt.target).height(evt.target.scrollHeight);
                                        }
                                        break;
                                }
                        }
                });
                

    var win = $(window);
    
    var loading = false;
    // Each time the user scrolls
    win.scroll(function() {
        if ($(document).height() - win.height() == win.scrollTop()) {
            if ($('#main_menu .news_btn').hasClass("active")){
            
                if (loading){
                    return;
                }	
                loading = true;
                
                $.ajax({
                    url: "/articles/load_more",
                    type: "GET",
                    data: {existing_articles : $('#main_contents').find('.article').length, period: $('#sub_menu .active').text() },
                    dataType: 'script',
                })
            } else if($('#main_menu .feed_btn').hasClass("active")){
            
                if (loading){
                    return;
                }	
                loading = true;
                
                $.ajax({
                    url: "/posts/load_more",
                    type: "GET",
                    data: {existing_posts : $('#main_contents').find('.post').length },
                    dataType: 'script',
                })
            }
        }
    });	

    $('#sub_menu').click(function(){
        if($(this).hasClass("open")){
            $('.dropdown').hide();
            $(this).removeClass("open");
            $(this).find("i").removeClass("fa-times");
            $(this).find("i").addClass("fa-caret-down");
        } else {
            $('.dropdown').fadeIn();
            $(this).addClass("open");
            $(this).find("i").removeClass("fa-caret-down");
            $(this).find("i").addClass("fa-times");
        }
    })

    // fix sidebar positionx

    
    $(window).scroll(function() {
        var scrollVolume = $(window).scrollTop();
        if(scrollVolume > 80){
            console.log(scrollVolume);
            $('#ad').css("position", "fixed");
            
            var position = $('#sidebar_right').offset();
            $('#ad').css("left", position.left);
            $('#ad').css("top", position.top - 80);
            
            $(window).resize(function() {
                var position = $('#sidebar_right').offset();
                $('#ad').css("left", position.left);
            });
            
        } else {
            $('#ad').css("position", "static");
        }
        
    });
 
    