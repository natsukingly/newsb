
#form_wrapper.dark_over_lay
#form_modal

// #test{style: "display:none;"}
//   YES IT'S WORKING!!


#side_nav
  =render 'layouts/feed_optimizer', default_category_tags: @default_category_tags, default_rigion_tags: @default_rigion_tags
  
#mobile_side_nav.visible-xs

#main_container
        
  .visible-xs#mobile_side_nav_link
    %i.fa.fa-hashtag
  
  
  #post_url_form.hidden-xs
    =form_tag "/posts/load_url", remote: true do
      .form-group.input-group
        = url_field_tag :placeholder_url, "", placeholder: "paste url to start your post!", class: "url_form form-control"
        %span.input-group-btn
          = button_tag type: :submit, class: "btn" do
            %i.fa.fa-pencil-square-o
            NEW POST
            
  #post_form_block

  .mobile_post_form.visible-xs
    =form_tag "/posts/mobile_load_url", remote: true, method: :get do
      .form-group.input-group
        = url_field_tag :placeholder_url, "", placeholder: "paste url to start your post!", class: "url_form form-control"
        %span.input-group-btn
          = button_tag type: :submit, class: "btn" do
            %i.fa.fa-pencil-square-o
            

  .posts#main_contents
    =render @posts

 
// sidebar   
#sidebar.hidden-xs.hidden-sm
  = render 'sidebars/feed', top_articles: @top_articles, top_users: @top_users

  
          
// = paginate @posts
// .scroller-status.text-center.hidden-xs
//   .infinite-scroll-request
//     .loading
//       %i.fa.fa-spinner.fa-spin{ style:"margin-top: 30px;"}
  
:javascript
  
  $('#mobile_side_nav_link').click(function(){
    if($(this).find('i').hasClass('fa-hashtag')){
      $(this).find('i').removeClass('fa-hashtag').addClass('fa-times');
      $(this).css("bottom", "auto").css("top", "70px");
      $('#side_nav').slideDown();
    } else {
      $('#side_nav').slideUp();
      $(this).find('i').removeClass('fa-times').addClass('fa-hashtag')
      $(this).css("bottom", "20px").css("top", "auto");
    }
  });
  

  
 

  // awesome autosize code

  
  $(".form_content").height(30);//init
  $(".form_content").css("lineHeight","20px");//init
  
  $(".form_content").on("input",function(evt){
            if(evt.target.scrollHeight > evt.target.offsetHeight){
                $(evt.target).height(evt.target.scrollHeight);
            }else{
                var lineHeight = Number($(evt.target).css("lineHeight").split("px")[0]);
                while (true){
                    $(evt.target).height($(evt.target).height() - lineHeight);
                    if(evt.target.scrollHeight > evt.target.offsetHeight){
                        $(evt.target).height(evt.target.scrollHeight);
                    }
                    break;
                }
            }
        });

  // $('.posts').infiniteScroll({
  //   path: "nav.pagination a[rel=next]",
  //   append: '.post',
  //   status: '.scroller-status',
  //   hideNav: '.pagination'
  // });
  
  
  var win = $(window);
  
  // Each time the user scrolls
  win.scroll(function() {
      // End of the document reached?
      if ($(document).height() - win.height() == win.scrollTop()) {
          // $(â€˜#loading').show();
  
        $.ajax({
          url: "/posts/load_more_posts",
          type: "GET",
          data: {already_loaded_posts : $('#main_contents').find('.post').length },
          dataType: 'script',
        });
      }
  });
  
  
